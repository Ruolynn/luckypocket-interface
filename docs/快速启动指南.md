# ğŸš€ HongBao dApp å¿«é€Ÿå¯åŠ¨æŒ‡å—

## å‰ç½®è¦æ±‚

- Node.js 20+
- pnpm 8+
- PostgreSQL 14+ï¼ˆæˆ–ä½¿ç”¨ Dockerï¼‰
- Redis 7+ï¼ˆæˆ–ä½¿ç”¨ Dockerï¼‰
- ä¸€ä¸ª Sepolia æµ‹è¯•ç½‘çš„é’±åŒ…å’Œ RPC URLï¼ˆä¾‹å¦‚ Alchemyï¼‰

---

## ä¸€ã€å®‰è£…ä¾èµ–

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
pnpm install
```

---

## äºŒã€é…ç½®ç¯å¢ƒå˜é‡

### 1. æ ¹ç›®å½•ç¯å¢ƒå˜é‡ï¼ˆDocker Composeï¼‰

å¤åˆ¶å¹¶ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env`ï¼š
```env
POSTGRES_PASSWORD=your_password
REDIS_PASSWORD=your_password
```

### 2. åç«¯ç¯å¢ƒå˜é‡

```bash
cd apps/api
cp .env.example .env
```

ç¼–è¾‘ `apps/api/.env`ï¼š
```env
PORT=3001
DATABASE_URL=postgresql://user:password@localhost:5432/hongbao
REDIS_URL=redis://localhost:6379
JWT_SECRET=your_jwt_secret_here
SIWE_DOMAIN=localhost
ETHEREUM_RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY
RED_PACKET_CONTRACT_ADDRESS=0x... # ä½ çš„åˆçº¦åœ°å€
PROXY_WALLET_PRIVATE_KEY=0x... # ä»£ç†é’±åŒ…ç§é’¥ï¼ˆç”¨äº Framesï¼‰
```

### 3. å‰ç«¯ç¯å¢ƒå˜é‡

```bash
cd apps/web
cp .env.example .env.local
```

ç¼–è¾‘ `apps/web/.env.local`ï¼š
```env
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXT_PUBLIC_CHAIN_ID=11155111
NEXT_PUBLIC_RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY
NEXT_PUBLIC_RED_PACKET_CONTRACT=0x... # ä½ çš„åˆçº¦åœ°å€
NEXT_PUBLIC_USDC_CONTRACT=0x94a9D9AC8a22534E3FaCa9F4e7F2E2cf85d5E4C8
```

---

## ä¸‰ã€å¯åŠ¨æ•°æ®åº“ï¼ˆä½¿ç”¨ Docker Composeï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
docker-compose up -d
```

è¿™å°†å¯åŠ¨ï¼š
- PostgreSQLï¼ˆç«¯å£ 5432ï¼‰
- Redisï¼ˆç«¯å£ 6379ï¼‰

---

## å››ã€åˆå§‹åŒ–æ•°æ®åº“

```bash
cd apps/api
pnpm prisma generate
pnpm prisma migrate dev
```

---

## äº”ã€éƒ¨ç½²æ™ºèƒ½åˆçº¦ï¼ˆå¯é€‰ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰åˆçº¦ï¼‰

```bash
cd packages/contracts

# ç¼–è¯‘åˆçº¦
forge build

# éƒ¨ç½²åˆ° Sepolia æµ‹è¯•ç½‘
forge script script/Deploy.s.sol:DeployScript \
  --rpc-url $ETHEREUM_RPC_URL \
  --private-key $PRIVATE_KEY \
  --broadcast
```

éƒ¨ç½²åï¼Œè®°ä¸‹åˆçº¦åœ°å€å¹¶æ›´æ–°åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚

---

## å…­ã€å¯åŠ¨åº”ç”¨

### æ–¹å¼ä¸€ï¼šåˆ†åˆ«å¯åŠ¨å‰åç«¯

**ç»ˆç«¯ 1 - å¯åŠ¨åç«¯ APIï¼š**
```bash
cd apps/api
pnpm dev
```

åç«¯å°†è¿è¡Œåœ¨ http://localhost:3001

**ç»ˆç«¯ 2 - å¯åŠ¨å‰ç«¯ï¼š**
```bash
cd apps/web
pnpm dev
```

å‰ç«¯å°†è¿è¡Œåœ¨ http://localhost:3000

### æ–¹å¼äºŒï¼šä½¿ç”¨æ ¹ç›®å½•è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œä½¿ç”¨ pnpm workspace
pnpm -r --parallel dev
```

---

## ä¸ƒã€è®¿é—®åº”ç”¨

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:3000
2. ç‚¹å‡»ã€Œè¿æ¥é’±åŒ…ã€ï¼Œè¿æ¥ä½ çš„ MetaMaskï¼ˆåˆ‡æ¢åˆ° Sepolia æµ‹è¯•ç½‘ï¼‰
3. ç‚¹å‡»ã€Œç­¾åç™»å½•ã€ï¼Œå®Œæˆ SIWE è®¤è¯
4. ç°åœ¨ä½ å¯ä»¥ï¼š
   - åˆ›å»ºçº¢åŒ…
   - é¢†å–çº¢åŒ…
   - æŸ¥çœ‹çº¢åŒ…è¯¦æƒ…

---

## å…«ã€æµ‹è¯•ä»£å¸å‡†å¤‡

### è·å–æµ‹è¯• ETH
è®¿é—® Sepolia æ°´é¾™å¤´è·å–æµ‹è¯• ETHï¼š
- https://sepoliafaucet.com/
- https://www.alchemy.com/faucets/ethereum-sepolia

### è·å–æµ‹è¯• USDC
å¦‚æœä½¿ç”¨çš„æ˜¯ MockERC20 åˆçº¦ï¼Œä½ éœ€è¦å…ˆ mint ä¸€äº›æµ‹è¯•ä»£å¸ï¼š

```solidity
// ä½¿ç”¨ Foundry cast æˆ–è€…åœ¨ Etherscan ä¸Šç›´æ¥è°ƒç”¨
cast send $USDC_CONTRACT \
  "mint(address,uint256)" \
  $YOUR_ADDRESS \
  "1000000000" \
  --rpc-url $ETHEREUM_RPC_URL \
  --private-key $PRIVATE_KEY
```

---

## ä¹ã€å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
ç¡®ä¿ PostgreSQL æ­£åœ¨è¿è¡Œï¼š
```bash
docker-compose ps
psql -U postgres -d hongbao  # æµ‹è¯•è¿æ¥
```

### 2. Redis è¿æ¥å¤±è´¥
ç¡®ä¿ Redis æ­£åœ¨è¿è¡Œï¼š
```bash
docker-compose ps
redis-cli ping  # åº”è¿”å› PONG
```

### 3. åˆçº¦è°ƒç”¨å¤±è´¥
- ç¡®è®¤åˆçº¦åœ°å€é…ç½®æ­£ç¡®
- ç¡®è®¤ RPC URL å¯ç”¨
- ç¡®è®¤é’±åŒ…æœ‰è¶³å¤Ÿçš„æµ‹è¯• ETH
- ç¡®è®¤ä»£å¸å·²æˆæƒ

### 4. SIWE è®¤è¯å¤±è´¥
- ç¡®è®¤ `SIWE_DOMAIN` ä¸å‰ç«¯è®¿é—®åŸŸåä¸€è‡´
- ç¡®è®¤ JWT_SECRET å·²é…ç½®
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### 5. å‰ç«¯æ„å»ºæ—¶ indexedDB è­¦å‘Š
è¿™æ˜¯ wagmi åœ¨ SSR æ—¶çš„å·²çŸ¥é—®é¢˜ï¼Œä¸å½±å“åŠŸèƒ½ï¼Œå¯ä»¥å¿½ç•¥ã€‚

---

## åã€å¼€å‘å·¥å…·

### Prisma Studioï¼ˆæ•°æ®åº“å¯è§†åŒ–ï¼‰
```bash
cd apps/api
pnpm prisma studio
```

è®¿é—® http://localhost:5555

### æŸ¥çœ‹æ—¥å¿—
```bash
# åç«¯æ—¥å¿—
cd apps/api
pnpm dev

# å‰ç«¯æ—¥å¿—
cd apps/web
pnpm dev

# Docker æ—¥å¿—
docker-compose logs -f
```

---

## åä¸€ã€åœæ­¢æœåŠ¡

```bash
# åœæ­¢ Docker æœåŠ¡
docker-compose down

# æˆ–è€…ä¿ç•™æ•°æ®
docker-compose stop
```

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ çš„ HongBao dApp åº”è¯¥å·²ç»åœ¨æœ¬åœ°æˆåŠŸè¿è¡Œäº†ã€‚

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- [å¼€å‘è¿›åº¦æŠ¥å‘Š](./å¼€å‘è¿›åº¦æŠ¥å‘Š.md)
- [PRD æ–‡æ¡£](./çº¢åŒ…dApp-PRD.md)
- [æŠ€æœ¯è½åœ°æ–¹æ¡ˆ](./æŠ€æœ¯è½åœ°æ–¹æ¡ˆ-æ¨¡å—æ¥å£ä¸ä¼ªä»£ç .md)
